#include <sys/types.h>
#include <sys/stat.h>
#include <fcntl.h>
#include <errno.h>
#include <sys/ioctl.h>
#include <unistd.h>
#include <stdio.h>
#include <fcntl.h>
#include <linux/fb.h>
#include <sys/mman.h>
#include <string.h>

unsigned char pic[]= {
    0x00,0x00,0x00,0x00,0x02,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x07,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x02,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x80,0xFF,0x00,0x80,0xFF,0x00,0x00,
	0x00,0xF0,0xFF,0x07,0xF0,0xFF,0x07,0x00,0x00,0xFC,0xC1,0x0F,0xF8,0xC1,0x1F,0x00,
	0x00,0x1E,0x00,0x3E,0x3E,0x00,0x3C,0x00,0x00,0x07,0x1E,0x78,0x0F,0x00,0xF0,0x00,
	0xC0,0x83,0x3F,0xF0,0x07,0x00,0xE0,0x01,0xC0,0xE1,0x3F,0xE0,0x03,0x00,0xC0,0x03,
	0xE0,0xF0,0x3F,0xC0,0x01,0x00,0x80,0x03,0x70,0xF8,0x1F,0x00,0x00,0x00,0x00,0x07,
	0x30,0xFC,0x07,0x00,0x00,0x00,0x00,0x0E,0x38,0xFE,0x01,0x00,0x00,0x00,0x00,0x0E,
	0x18,0xFE,0x00,0x00,0x00,0x00,0x00,0x0C,0x1C,0x7F,0x00,0x00,0x00,0x00,0x00,0x1C,
	0x0C,0x3F,0x00,0x04,0x00,0x20,0x00,0x18,0x8C,0x3F,0x00,0x0C,0x00,0x70,0x00,0x18,
	0x8C,0x1F,0x00,0x0E,0x00,0x70,0x00,0x38,0x8E,0x1F,0x00,0x0E,0x00,0x70,0x00,0x38,
	0x8E,0x0F,0x00,0x1E,0x00,0x78,0x00,0x38,0x8E,0x0F,0x00,0x1E,0x0C,0x78,0x00,0x30,
	0x8E,0x0F,0x00,0x1F,0x0C,0x78,0x00,0x30,0x8E,0x0F,0x00,0x1F,0x1C,0x7C,0x00,0x30,
	0x0E,0x07,0x00,0x1B,0x1C,0x7C,0x00,0x38,0x0C,0x00,0x00,0x1B,0x1E,0x7E,0x00,0x38,
	0x0C,0x00,0x80,0x3B,0x1E,0x7E,0x00,0x10,0x00,0x00,0x80,0x39,0x3E,0x76,0x00,0x00,
	0x00,0x00,0x80,0x31,0x36,0x77,0x00,0x00,0xFF,0xFF,0xFF,0x31,0xF6,0x73,0xFF,0xFF,
	0xFF,0xFF,0xFF,0x31,0xF6,0x73,0xFF,0xFF,0xFF,0xFF,0xFF,0x30,0xE7,0xF1,0xFF,0xFF,
	0x00,0x00,0x00,0x70,0x07,0xF0,0x01,0x00,0x00,0x00,0x00,0x70,0x07,0xF0,0x01,0x00,
	0xC0,0x00,0x00,0x60,0x03,0xF0,0x00,0x03,0xE0,0x00,0x00,0x60,0x03,0x70,0x80,0x03,
	0xC0,0x01,0x00,0x60,0x03,0x70,0xC0,0x01,0x80,0x03,0x00,0xE0,0x03,0x00,0xE0,0x00,
	0x80,0x03,0x00,0xE0,0x03,0x00,0xE0,0x00,0x00,0x07,0x00,0xE0,0x03,0x00,0x70,0x00,
	0x00,0x0E,0x00,0xC0,0x03,0x00,0x38,0x00,0x00,0x1C,0x00,0xC0,0x01,0x00,0x1C,0x00,
	0x00,0x38,0x00,0xC0,0x01,0x00,0x0E,0x00,0x00,0x70,0x00,0xC0,0x01,0x00,0x0F,0x00,
	0x00,0xE0,0x00,0xC0,0x01,0x80,0x07,0x00,0x00,0xC0,0x01,0xC0,0x01,0xC0,0x03,0x00,
	0x00,0x80,0x03,0x80,0x00,0xE0,0x01,0x00,0x00,0x00,0x07,0x00,0x00,0xF0,0x00,0x00,
	0x00,0x00,0x0E,0x00,0x00,0x78,0x00,0x00,0x00,0x00,0x1C,0x00,0x00,0x1C,0x00,0x00,
	0x00,0x01,0x38,0x00,0x00,0x0E,0x00,0x00,0x80,0x03,0xF0,0x00,0x80,0x07,0x00,0x00,
	0x00,0x01,0xE0,0x01,0xC0,0x03,0x00,0x00,0x00,0x00,0xC0,0x03,0xE0,0x01,0x10,0x00,
	0x00,0x00,0x00,0x07,0x70,0x00,0x38,0x00,0x00,0x00,0x00,0x1E,0x3C,0x00,0x10,0x00,
	0x00,0x00,0x00,0x3C,0x1E,0x00,0x00,0x00,0x00,0x00,0x00,0xF0,0x07,0x00,0x00,0x00,
	0x00,0x00,0x00,0xE0,0x03,0x00,0x00,0x00,0x00,0x00,0x00,0x80,0x01,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
};// show two heart

void main()
{
    struct fb_var_screeninfo vinfo;
    int screenSize = 0;
    char *p = NULL;

    int fd = open("/dev/fb0", O_RDWR);
    if(-1 == fd)
    {
        printf("failed to open framebuffer device : %s\n", strerror(errno));
        return;
    }

    if(ioctl(fd, FBIOGET_VSCREENINFO, &vinfo) == -1)
    {
        printf("failed to reading variable info : %s\n", strerror(errno));
        return;
    }

    printf("R : %d, G : %d, B : %d\n", vinfo.red.length, vinfo.green.length, vinfo.blue.length);
    printf("%dx%d, %dbpp\n", vinfo.xres, vinfo.yres, vinfo.bits_per_pixel);

    screenSize = vinfo.xres * vinfo.yres * vinfo.bits_per_pixel / 8; // 8bit --> one unsigned char

    p = (char *)mmap(0, screenSize, PROT_READ | PROT_WRITE, MAP_SHARED, fd, 0);
    if(NULL == p)
    {
        printf("failed to map framebuffer device to memory : %s\n", strerror(errno));
    }
    printf("success to map framebuffer device to memory! \n");


    ////////////////
    memcpy(p, pic, sizeof(pic));

    /////////////////

    munmap(p, screenSize);
    close(fd);
}